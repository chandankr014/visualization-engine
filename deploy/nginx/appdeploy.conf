# Nginx site config for AppDeploy
#
# - Serves ONLY /opt/appdeploy/public (static assets + datasets)
# - Proxies /api/* to the Python server bound to localhost
#
# Install (Ubuntu):
#   sudo cp deploy/nginx/appdeploy.conf /etc/nginx/sites-available/appdeploy
#   sudo ln -s /etc/nginx/sites-available/appdeploy /etc/nginx/sites-enabled/appdeploy
#   sudo nginx -t && sudo systemctl restart nginx
#

server {
  listen 80;
  server_name _;

  root /opt/appdeploy/public;
  index viewer.html;

  # Static frontend
  location / {
    try_files $uri $uri/ /viewer.html;
  }

  # API -> python (localhost only)
  location /api/ {
    proxy_pass http://127.0.0.1:8000;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Optional: basic hardening
  location ~ /\. {
    deny all;
  }
}
